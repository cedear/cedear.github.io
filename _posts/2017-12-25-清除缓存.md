---
layout:     post
title:      æ¸…é™¤ç¼“å­˜
subtitle:   ç¼“å­˜æ–‡ä»¶çš„æ¸…é™¤å’Œç›¸å…³å†…å®¹
date:       2017-12-25
author:     Cedar7
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - ç¼“å­˜æ¸…é™¤
    - æ–‡ä»¶ç›®å½•ç»“æ„
---

## æ¸…é™¤ç¼“å­˜
åœ¨è¿›è¡Œæ¸…é™¤ç¼“å­˜çš„ä¹‹å‰ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬åº”è¯¥å…ˆäº†è§£ä¸€ä¸‹Androidçš„ç›®å½•æ–‡ä»¶ç»“æ„ã€‚  
![image](https://note.youdao.com/yws/api/personal/file/WEB34beb851a2230b379e104be2652f689f?method=download&shareKey=79cbc65d1cf8cb28c27e82055deed499)  
åº”ç”¨ç¨‹åºåœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å¦‚æœéœ€è¦å‘æ‰‹æœºä¸Šä¿å­˜æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŠŠæ•°æ®ä¿å­˜åœ¨SDcardä¸­çš„ã€‚
å¤§éƒ¨åˆ†åº”ç”¨æ˜¯ç›´æ¥åœ¨SDCardçš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åæŠŠæ•°æ®ä¿å­˜åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ã€‚
è¿™æ ·å½“è¯¥åº”ç”¨è¢«å¸è½½åï¼Œè¿™äº›æ•°æ®è¿˜ä¿ç•™åœ¨SDCardä¸­ï¼Œç•™ä¸‹äº†åƒåœ¾æ•°æ®ã€‚å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨è¢«å¸è½½åï¼Œä¸è¯¥åº”ç”¨ç›¸å…³çš„æ•°æ®ä¹Ÿæ¸…é™¤æ‰ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ 

é€šè¿‡Context.getExternalFilesDir()æ–¹æ³•å¯ä»¥è·å–åˆ° SDCard/Android/data/ä½ çš„åº”ç”¨çš„åŒ…å/files/ ç›®å½•ï¼Œä¸€èˆ¬æ”¾ä¸€äº›é•¿æ—¶é—´ä¿å­˜çš„æ•°æ®  

é€šè¿‡Context.getExternalCacheDir()æ–¹æ³•å¯ä»¥è·å–åˆ° SDCard/Android/data/ä½ çš„åº”ç”¨åŒ…å/cache/ç›®å½•ï¼Œä¸€èˆ¬å­˜æ”¾ä¸´æ—¶ç¼“å­˜æ•°æ®  

å¦‚æœä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œå½“ä½ çš„åº”ç”¨åœ¨è¢«ç”¨æˆ·å¸è½½åï¼ŒSDCard/Android/data/ä½ çš„åº”ç”¨çš„åŒ…å/ è¿™ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«åˆ é™¤ï¼Œä¸ä¼šç•™ä¸‹åƒåœ¾ä¿¡æ¯ã€‚  


è€Œä¸”ä¸Šé¢äºŒä¸ªç›®å½•åˆ†åˆ«å¯¹åº” è®¾ç½®->åº”ç”¨->åº”ç”¨è¯¦æƒ…é‡Œé¢çš„â€æ¸…é™¤æ•°æ®â€œä¸â€æ¸…é™¤ç¼“å­˜â€œé€‰é¡¹ã€‚
å¦‚æœè¦ä¿å­˜ä¸‹è½½çš„å†…å®¹ï¼Œå°±ä¸è¦æ”¾åœ¨ä»¥ä¸Šç›®å½•ä¸‹  

> åœ¨ç°åœ¨å¤§å¤šæ•°çš„Appä¸­ï¼Œéƒ½æœ‰å¾ˆå¤šå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„æ¡†æ¶ï¼Œå¦‚ç½‘ç»œæ–¹é¢çš„OkHttpã€Volleyã€retrofitç­‰ï¼Œå›¾ç‰‡åŠ è½½æ–¹é¢çš„ImageLoaderã€Picassioã€Glideç­‰ã€‚è¿™äº›å¼€æºçš„æ¡†æ¶éƒ½å…·æœ‰ç¼“å­˜çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ‰èƒ½è®©æˆ‘ä»¬äºŒæ¬¡åŠ è½½æŸäº›èµ„æºçš„æ—¶å€™æ‰èƒ½æ›´åŠ å¿«é€Ÿã€‚åœ¨æˆ‘ä¹‹å‰çš„é¡¹ç›®å½“ä¸­ï¼Œâ€œæ¸…é™¤ç¼“å­˜â€çš„åŠŸèƒ½åªæ˜¯ç®€å•çš„è°ƒç”¨ImageLoaderçš„clearCache()æ–¹æ³•ï¼Œå…¶å®æ¸…é™¤çš„åªæ˜¯å›¾ç‰‡çš„ç¼“å­˜ï¼Œå¹¶æ²¡æœ‰å°†Appä¸­çš„å…¶ä»–ç¼“å­˜æ¸…é™¤ï¼Œåªæ˜¯ç»™ç”¨æˆ·ä¸€ç§â€œæŸäº›ä¸œè¥¿è¢«æ¸…é™¤äº†çš„æ„Ÿè§‰â€(å› ä¸ºç¼“å­˜æ˜¾ç¤ºçš„å¤§å°å˜ä¸ºäº†0ğŸ¤¦ğŸ¤¦ğŸ¤¦ğŸ˜‚ğŸ˜‚ï¼‰ã€‚å…¶å®å¦‚æœæƒ³æ¸…é™¤Appä¸­çš„æ‰€æœ‰ç¼“å­˜æ–‡ä»¶ï¼Œé‚£å°±æŠŠcacheæ–‡ä»¶ä¸‹çš„ä¸œè¥¿éƒ½å¹²æ‰ä¸å°±å¯ä»¥äº†å—ï¼Ÿå¯¹çš„ï¼Œç°åœ¨å°±è®²ä¸€ä¸‹æ€ä¹ˆå¹²æ‰cacheæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿ï¼š  
### æ¸…é™¤cacheæ–‡ä»¶ä¸‹æ‰€æœ‰æ–‡ä»¶

```
public class CacheCleanManager {

    public static String getTotalCacheSize(Context context) throws Exception {
        long cacheSize = getFolderSize(context.getCacheDir());
        if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            cacheSize += getFolderSize(context.getExternalCacheDir());
        }
        return getFormatSize(cacheSize);
    }


    public static void clearAllCache(Context context) {
        deleteDir(context.getCacheDir());
        if (Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED)) {
            deleteDir(context.getExternalCacheDir());
        }
    }

    private static boolean deleteDir(File dir) {
        if (dir != null && dir.isDirectory()) {
            String[] children = dir.list();
            for (int i = 0; i < children.length; i++) {
                boolean success = deleteDir(new File(dir, children[i]));
                if (!success) {
                    return false;
                }
            }
        }
        return dir.delete();
    }

    // è·å–æ–‡ä»¶
    //Context.getExternalFilesDir() --> SDCard/Android/data/ä½ çš„åº”ç”¨çš„åŒ…å/files/ ç›®å½•ï¼Œä¸€èˆ¬æ”¾ä¸€äº›é•¿æ—¶é—´ä¿å­˜çš„æ•°æ®
    //Context.getExternalCacheDir() --> SDCard/Android/data/ä½ çš„åº”ç”¨åŒ…å/cache/ç›®å½•ï¼Œä¸€èˆ¬å­˜æ”¾ä¸´æ—¶ç¼“å­˜æ•°æ®
    public static long getFolderSize(File file) throws Exception {
        long size = 0;
        try {
            File[] fileList = file.listFiles();
            for (int i = 0; i < fileList.length; i++) {
                // å¦‚æœä¸‹é¢è¿˜æœ‰æ–‡ä»¶
                if (fileList[i].isDirectory()) {
                    size = size + getFolderSize(fileList[i]);
                } else {
                    size = size + fileList[i].length();
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return size;
    }

    /**
     * æ ¼å¼åŒ–å•ä½
     *
     * @param size
     * @return
     */
    public static String getFormatSize(double size) {
        double kiloByte = size / 1024;
        if (kiloByte < 1) {
//            return size + "Byte";
            return "0.00KB";
        }

        double megaByte = kiloByte / 1024;
        if (megaByte < 1) {
            BigDecimal result1 = new BigDecimal(Double.toString(kiloByte));
            return result1.setScale(2, BigDecimal.ROUND_HALF_UP)
                    .toPlainString() + "KB";
        }

        double gigaByte = megaByte / 1024;
        if (gigaByte < 1) {
            BigDecimal result2 = new BigDecimal(Double.toString(megaByte));
            return result2.setScale(2, BigDecimal.ROUND_HALF_UP)
                    .toPlainString() + "MB";
        }

        double teraBytes = gigaByte / 1024;
        if (teraBytes < 1) {
            BigDecimal result3 = new BigDecimal(Double.toString(gigaByte));
            return result3.setScale(2, BigDecimal.ROUND_HALF_UP)
                    .toPlainString() + "GB";
        }
        BigDecimal result4 = new BigDecimal(teraBytes);
        return result4.setScale(2, BigDecimal.ROUND_HALF_UP).toPlainString()
                + "TB";
    }
}
```
##### æ˜¾ç¤ºå½“å‰ç¼“å­˜å¤§å°
```
tvCacheSize.setText(CacheCleanManager.getTotalCacheSize(this));
```
##### æ¸…é™¤å½“å‰ç¼“å­˜

```
public void clearCache() {
        new MaterialDialog.Builder(context)
                .title("æç¤º")
                .content("ç¡®å®šæ¸…é™¤å½“å‰ç¼“å­˜")
                .contentColor(context.getResources().getColor(R.color.live_text_color_light))
                .positiveColor(context.getResources().getColor(R.color.live_blue))
                .positiveText("ç¡®å®š")
                .negativeColor(context.getResources().getColor(R.color.live_text_color))
                .negativeText("å–æ¶ˆ")
                .onPositive(new MaterialDialog.SingleButtonCallback() {
                    @Override
                    public void onClick(@NonNull MaterialDialog materialDialog, @NonNull DialogAction dialogAction) {
                        try {
                            CacheCleanManager.clearAllCache(MainActivity.this);
                            tvCacheSize.setText("0.00KB");
                        } catch (Exception e) {
                                e.printStackTrace();
                        }
                        materialDialog.dismiss();
                    }
                })
                .onNegative(new MaterialDialog.SingleButtonCallback() {
                    @Override
                    public void onClick(@NonNull MaterialDialog materialDialog, @NonNull DialogAction dialogAction) {
                        materialDialog.dismiss();
                    }
                })
                .build()
                .show();
    }
```
## By the way
å½“åˆåœ¨é¡¹ç›®ä¸­è¿™æ ·æ¸…é™¤ç¼“å­˜çš„æ—¶å€™ï¼Œèº«è¾¹æœ‰äººè¯´æœ¬åœ°å­˜å‚¨çš„ä¸€äº›è´¦å·ä¿¡æ¯ã€ç™»å½•çŠ¶æ€ç­‰ä¼šä¸ä¼šä¹Ÿè¢«æ¸…é™¤ã€‚æˆ‘æƒ³è¯´ï¼šé‚£å°±çœ‹ä½ è¿™äº›ä¸œè¥¿å­˜å‚¨åˆ°å“ªé‡Œäº†ï¼Œå¦‚æœä½ å­˜å‚¨åˆ°cacheä¸‹ï¼Œé‚£è‚¯å®šæ˜¯è¢«åˆ é™¤äº†ã€‚ä½†é€šå¸¸å¯¹äºè¿™äº›æ•æ„Ÿçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éƒ½é‡‡ç”¨Sharedpreferencesè¿›è¡Œå­˜å‚¨ï¼Œå®ƒæ‰€å­˜å‚¨çš„ç›®å½•ä½äºâ€œ/data/data/åº”ç”¨ç¨‹åºåŒ…/shared_prefsâ€ç›®å½•ä¸‹ï¼Œåªæœ‰é€šè¿‡adb shellæ‰å¯ä»¥æ‰“å¼€ã€‚æ‰€ä»¥è¯¥ç§æ¸…é™¤ç¼“å­˜æ–¹å¼å¹¶ä¸ä¼šå½±å“è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚


